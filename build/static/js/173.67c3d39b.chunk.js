"use strict";(self.webpackChunkquantum_trade_ai_v2=self.webpackChunkquantum_trade_ai_v2||[]).push([[173],{173:(t,e,r)=>{r.d(e,{default:()=>i});var s=r(555);const a="undefined"!==typeof window;const i=class{constructor(){this.model={version:"2.0",accuracy:.65,confidence:.5,trainingData:[],patterns:new Map,strategies:new Map,performance:new Map},this.features={technical:["rsi","macd","bollinger","vwap","ema","sma"],sentiment:["social","news","options_flow"],market:["volume","volatility","trend","momentum"]},this.tradeHistory=[],this.activeTrades=[],this.recommendations=[],this.loadModel(),this.initializeNeuralNetwork()}initializeNeuralNetwork(){this.network={inputLayer:15,hiddenLayers:[30,20,10],outputLayer:5,weights:this.initializeWeights(),learningRate:.01}}initializeWeights(){const t={};return t.ih=Array(30).fill(0).map(()=>Array(15).fill(0).map(()=>Math.random()-.5)),t.hh1=Array(20).fill(0).map(()=>Array(30).fill(0).map(()=>Math.random()-.5)),t.hh2=Array(10).fill(0).map(()=>Array(20).fill(0).map(()=>Math.random()-.5)),t.ho=Array(5).fill(0).map(()=>Array(10).fill(0).map(()=>Math.random()-.5)),t}loadModel(){if(!a)return;const t=localStorage.getItem("mlTradingModel");if(t)try{const e=JSON.parse(t);this.model=(0,s.A)((0,s.A)({},this.model),e),e.patterns&&(this.model.patterns=new Map(e.patterns)),e.strategies&&(this.model.strategies=new Map(e.strategies)),e.performance&&(this.model.performance=new Map(e.performance)),console.log("ML Model loaded. Accuracy:",this.model.accuracy)}catch(r){console.log("Starting fresh ML model")}const e=localStorage.getItem("mlTradeHistory");e&&(this.tradeHistory=JSON.parse(e))}saveModel(){if(!a)return;const t=(0,s.A)((0,s.A)({},this.model),{},{patterns:Array.from(this.model.patterns.entries()),strategies:Array.from(this.model.strategies.entries()),performance:Array.from(this.model.performance.entries())});localStorage.setItem("mlTradingModel",JSON.stringify(t)),localStorage.setItem("mlTradeHistory",JSON.stringify(this.tradeHistory))}extractFeatures(t){const e=[];return e.push(this.calculateRSI(t.prices)),e.push(this.calculateMACD(t.prices)),e.push(this.calculateBollingerBands(t.prices)),e.push(t.vwap||0),e.push(this.normalizeVolume(t.volume)),e.push(this.calculateVolatility(t.prices)),e.push(this.calculateTrend(t.prices)),e.push(this.calculateMomentum(t.prices)),e.push(t.callVolume/(t.putVolume||1)),e.push(t.unusualActivity?1:0),e.push(t.socialSentiment||0),e.push(t.newsSentiment||0),e.push(t.marketCap||0),e.push(t.sectorStrength||0),e.push(t.correlationSPY||0),e.map(t=>isNaN(t)?0:t)}predict(t){let e=t;const{weights:r}=this.network;e=this.activate(this.matrixMultiply(e,r.ih)),e=this.activate(this.matrixMultiply(e,r.hh1)),e=this.activate(this.matrixMultiply(e,r.hh2));const s=this.softmax(this.matrixMultiply(e,r.ho));return{buyStrong:s[0],buy:s[1],hold:s[2],sell:s[3],sellStrong:s[4],confidence:Math.max(...s)}}async train(t){const e=this.extractFeatures(t.marketData),r=this.encodeOutcome(t.result);return this.model.trainingData.push({features:e,outcome:r,timestamp:Date.now(),symbol:t.symbol,strategy:t.strategy}),this.model.trainingData.length>1e4&&(this.model.trainingData=this.model.trainingData.slice(-1e4)),await this.backpropagate(e,r),this.updatePatterns(t),this.updateStrategyPerformance(t),this.updateModelAccuracy(),this.saveModel(),{accuracy:this.model.accuracy,confidence:this.model.confidence,totalTrades:this.model.trainingData.length}}async backpropagate(t,e){const r=this.predict(t),s=this.calculateError(r,e),{weights:a,learningRate:i}=this.network;Object.keys(a).forEach(t=>{a[t]=a[t].map(t=>t.map(t=>t-i*s*Math.random()))}),this.network.weights=a}updatePatterns(t){const e=this.identifyPattern(t.marketData);this.model.patterns.has(e.type)||this.model.patterns.set(e.type,{occurrences:0,successRate:0,totalReturn:0});const r=this.model.patterns.get(e.type);r.occurrences++,t.result.profit>0?r.successRate=(r.successRate*(r.occurrences-1)+1)/r.occurrences:r.successRate=r.successRate*(r.occurrences-1)/r.occurrences,r.totalReturn+=t.result.percentReturn,this.model.patterns.set(e.type,r)}identifyPattern(t){const e=[];return this.isGoldenCross(t)&&e.push("golden_cross"),this.isBullFlag(t)&&e.push("bull_flag"),this.isCupAndHandle(t)&&e.push("cup_handle"),this.isDeathCross(t)&&e.push("death_cross"),this.isBearFlag(t)&&e.push("bear_flag"),this.isHeadAndShoulders(t)&&e.push("head_shoulders"),this.isTriangle(t)&&e.push("triangle"),this.isRange(t)&&e.push("range_bound"),{type:e.join("_")||"unknown",patterns:e}}updateStrategyPerformance(t){const{strategy:e}=t;this.model.strategies.has(e)||this.model.strategies.set(e,{trades:0,wins:0,losses:0,totalReturn:0,avgReturn:0,winRate:0,sharpeRatio:0});const r=this.model.strategies.get(e);r.trades++,t.result.profit>0?r.wins++:r.losses++,r.totalReturn+=t.result.percentReturn,r.avgReturn=r.totalReturn/r.trades,r.winRate=r.wins/r.trades,r.sharpeRatio=this.calculateSharpeRatio(e),this.model.strategies.set(e,r)}generateRecommendations(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=[];return(e.symbols||["SPY","QQQ","AAPL","NVDA","TSLA"]).forEach(s=>{const a=this.getMarketData(s,t),i=this.extractFeatures(a),l=this.predict(i),n=this.identifyPattern(a),c=this.model.patterns.get(n.type)||{successRate:.5,occurrences:0},o=this.determineAction(l);("hold"!==o||e.includeHold)&&r.push({symbol:s,action:o,confidence:l.confidence,expectedReturn:this.calculateExpectedReturn(l,c),risk:this.calculateRisk(a),pattern:n.type,patternSuccess:c.successRate,reasoning:this.generateReasoning(l,n,a),timeframe:e.timeframe||"1D",entryPrice:a.currentPrice,stopLoss:this.calculateStopLoss(a,o),takeProfit:this.calculateTakeProfit(a,o),positionSize:this.calculatePositionSize(a,e.capital||1e4)})}),r.sort((t,e)=>e.confidence*e.expectedReturn-t.confidence*t.expectedReturn),r.slice(0,e.limit||5)}recordTrade(t){this.tradeHistory.push((0,s.A)((0,s.A)({},t),{},{timestamp:Date.now(),modelVersion:this.model.version,modelAccuracy:this.model.accuracy})),"closed"===t.status&&this.train({symbol:t.symbol,strategy:t.strategy,marketData:t.entryMarketData,result:{profit:t.profit,percentReturn:t.percentReturn,holdingPeriod:t.exitTime-t.entryTime}}),"open"===t.status?this.activeTrades.push(t):this.activeTrades=this.activeTrades.filter(e=>e.id!==t.id),this.saveModel()}getPerformanceMetrics(){return{modelAccuracy:this.model.accuracy,modelConfidence:this.model.confidence,totalTrades:this.tradeHistory.length,winRate:this.calculateWinRate(),avgReturn:this.calculateAvgReturn(),sharpeRatio:this.calculateOverallSharpe(),maxDrawdown:this.calculateMaxDrawdown(),profitFactor:this.calculateProfitFactor(),strategies:Array.from(this.model.strategies.entries()).map(t=>{let[e,r]=t;return(0,s.A)({name:e},r)}),patterns:Array.from(this.model.patterns.entries()).sort((t,e)=>e[1].successRate-t[1].successRate).slice(0,10).map(t=>{let[e,r]=t;return(0,s.A)({name:e},r)}),recentTrades:this.tradeHistory.slice(-10),activeTrades:this.activeTrades}}calculateRSI(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;if(t.length<e)return 50;let r=0,s=0;for(let a=1;a<e;a++){const e=t[a]-t[a-1];e>0?r+=e:s-=e}return 100-100/(1+r/e/(s/e||1))}calculateMACD(t){return this.calculateEMA(t,12)-this.calculateEMA(t,26)}calculateEMA(t,e){if(0===t.length)return 0;const r=2/(e+1);let s=t[0];for(let a=1;a<t.length;a++)s=(t[a]-s)*r+s;return s}calculateBollingerBands(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;const r=t.slice(-e).reduce((t,e)=>t+e,0)/e,s=t.slice(-e).reduce((t,e)=>t+Math.pow(e-r,2),0)/e,a=Math.sqrt(s);return(t[t.length-1]-r)/(2*a)}calculateVolatility(t){if(t.length<2)return 0;const e=[];for(let a=1;a<t.length;a++)e.push((t[a]-t[a-1])/t[a-1]);const r=e.reduce((t,e)=>t+e,0)/e.length,s=e.reduce((t,e)=>t+Math.pow(e-r,2),0)/e.length;return Math.sqrt(252*s)}calculateTrend(t){if(t.length<2)return 0;const e=t.length,r=Array.from({length:e},(t,e)=>e),s=r.reduce((t,e)=>t+e,0),a=t.reduce((t,e)=>t+e,0);return(e*r.reduce((e,r,s)=>e+r*t[s],0)-s*a)/(e*r.reduce((t,e)=>t+e*e,0)-s*s)}calculateMomentum(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(t.length<e)return 0;const r=t[t.length-1],s=t[t.length-e];return(r-s)/s}isGoldenCross(t){const e=this.calculateSMA(t.prices,50),r=this.calculateSMA(t.prices,200);return this.calculateSMA(t.prices.slice(0,-1),50)<=this.calculateSMA(t.prices.slice(0,-1),200)&&e>r}isDeathCross(t){const e=this.calculateSMA(t.prices,50),r=this.calculateSMA(t.prices,200);return this.calculateSMA(t.prices.slice(0,-1),50)>=this.calculateSMA(t.prices.slice(0,-1),200)&&e<r}isBullFlag(t){const e=t.prices.slice(-20),r=this.calculateTrend(e),s=this.calculateVolatility(e.slice(-5));return r>.02&&s<.1}isBearFlag(t){const e=t.prices.slice(-20),r=this.calculateTrend(e),s=this.calculateVolatility(e.slice(-5));return r<-.02&&s<.1}isCupAndHandle(t){if(t.prices.length<50)return!1;const e=t.prices.slice(-50),r=Math.floor(e.length/2),s=Math.max(...e.slice(0,r)),a=Math.min(...e.slice(r-10,r+10)),i=Math.max(...e.slice(r));return Math.abs(s-i)/s<.05&&(s-a)/s>.1}isHeadAndShoulders(t){if(t.prices.length<30)return!1;const e=t.prices.slice(-30),r=Math.floor(e.length/3),s=Math.max(...e.slice(0,r)),a=Math.max(...e.slice(r,2*r)),i=Math.max(...e.slice(2*r));return a>s&&a>i&&Math.abs(s-i)/s<.05}isTriangle(t){const e=[],r=[];for(let i=0;i<t.prices.length-5;i+=5){const s=t.prices.slice(i,i+5);e.push(Math.max(...s)),r.push(Math.min(...s))}const s=this.calculateTrend(e),a=this.calculateTrend(r);return Math.abs(s)<.01&&a>.01}isRange(t){const e=this.calculateVolatility(t.prices),r=Math.abs(this.calculateTrend(t.prices));return e<.15&&r<.001}calculateSMA(t,e){return t.length<e?t[t.length-1]||0:t.slice(-e).reduce((t,e)=>t+e,0)/e}normalizeVolume(t){return Math.min(t/1e7,2)}activate(t){return Array.isArray(t)?t.map(t=>Math.max(0,t)):Math.max(0,t)}softmax(t){const e=Math.max(...t),r=t.map(t=>Math.exp(t-e)),s=r.reduce((t,e)=>t+e,0);return r.map(t=>t/s)}matrixMultiply(t,e){return e.map(e=>e.reduce((e,r,s)=>e+r*(t[s]||0),0))}calculateError(t,e){return[t.buyStrong,t.buy,t.hold,t.sell,t.sellStrong].reduce((t,r,s)=>t+Math.pow(r-(e[s]||0),2),0)}encodeOutcome(t){const e=t.percentReturn;return e>10?[1,0,0,0,0]:e>3?[0,1,0,0,0]:e>-3?[0,0,1,0,0]:e>-10?[0,0,0,1,0]:[0,0,0,0,1]}determineAction(t){const e=[t.buyStrong,t.buy,t.hold,t.sell,t.sellStrong];return["buyStrong","buy","hold","sell","sellStrong"][e.indexOf(Math.max(...e))]}calculateExpectedReturn(t,e){return 15*t.buyStrong+7*t.buy+0*t.hold+-7*t.sell+-15*t.sellStrong+10*(e.successRate-.5)}calculateRisk(t){const e=this.calculateVolatility(t.prices),r=this.calculateATR(t);return Math.min(e*r,1)}calculateATR(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;if(!t.highs||!t.lows||t.highs.length<e)return.02;const r=[];for(let s=1;s<t.highs.length;s++){const e=t.highs[s],a=t.lows[s],i=t.prices[s-1],l=Math.max(e-a,Math.abs(e-i),Math.abs(a-i));r.push(l)}return r.slice(-e).reduce((t,e)=>t+e,0)/e/t.prices[t.prices.length-1]}calculateStopLoss(t,e){const r=this.calculateATR(t),s=t.currentPrice;return e.includes("buy")?s*(1-2*r):e.includes("sell")?s*(1+2*r):s}calculateTakeProfit(t,e){const r=this.calculateATR(t),s=t.currentPrice;return e.includes("buy")?s*(1+3*r):e.includes("sell")?s*(1-3*r):s}calculatePositionSize(t,e){const r=.02*e/this.calculateRisk(t);return Math.min(r,.25*e)}generateReasoning(t,e,r){const s=[];t.buyStrong>.5?s.push("Strong bullish signals detected"):t.buy>.5?s.push("Moderate bullish signals present"):t.sell>.5&&s.push("Bearish indicators dominating"),e.patterns.length>0&&s.push("Pattern detected: ".concat(e.patterns.join(", ")));const a=this.calculateRSI(r.prices);return a<30&&s.push("RSI indicates oversold conditions"),a>70&&s.push("RSI indicates overbought conditions"),r.volume>1.5*r.avgVolume&&s.push("Unusual volume detected"),s.push("Model confidence: ".concat((100*t.confidence).toFixed(1),"%")),s.join(". ")}updateModelAccuracy(){if(this.tradeHistory.length<10)return;const t=this.tradeHistory.slice(-100),e=t.filter(t=>"buy"===t.prediction&&t.result&&t.result.profit>0||"sell"===t.prediction&&t.result&&t.result.profit>0||"hold"===t.prediction&&t.result&&Math.abs(t.result.percentReturn)<2).length;this.model.accuracy=e/t.length,this.model.confidence=Math.min(1.2*this.model.accuracy,1)}calculateWinRate(){if(0===this.tradeHistory.length)return 0;return this.tradeHistory.filter(t=>t.result&&t.result.profit>0).length/this.tradeHistory.length}calculateAvgReturn(){if(0===this.tradeHistory.length)return 0;return this.tradeHistory.reduce((t,e)=>{var r;return t+((null===(r=e.result)||void 0===r?void 0:r.percentReturn)||0)},0)/this.tradeHistory.length}calculateOverallSharpe(){if(this.tradeHistory.length<2)return 0;const t=this.tradeHistory.map(t=>{var e;return(null===(e=t.result)||void 0===e?void 0:e.percentReturn)||0}),e=t.reduce((t,e)=>t+e,0)/t.length,r=t.reduce((t,r)=>t+Math.pow(r-e,2),0)/t.length,s=Math.sqrt(r);return 0===s?0:(e-.02)/s}calculateSharpeRatio(t){const e=this.tradeHistory.filter(e=>e.strategy===t);if(e.length<2)return 0;const r=e.map(t=>{var e;return(null===(e=t.result)||void 0===e?void 0:e.percentReturn)||0}),s=r.reduce((t,e)=>t+e,0)/r.length,a=r.reduce((t,e)=>t+Math.pow(e-s,2),0)/r.length,i=Math.sqrt(a);return 0===i?0:(s-.02)/i}calculateMaxDrawdown(){if(0===this.tradeHistory.length)return 0;let t=0,e=0,r=0;return this.tradeHistory.forEach(s=>{var a;r+=(null===(a=s.result)||void 0===a?void 0:a.profit)||0,r>t&&(t=r);const i=(t-r)/t;i>e&&(e=i)}),e}calculateProfitFactor(){const t=this.tradeHistory.filter(t=>t.result&&t.result.profit>0).reduce((t,e)=>t+e.result.profit,0),e=Math.abs(this.tradeHistory.filter(t=>t.result&&t.result.profit<0).reduce((t,e)=>t+e.result.profit,0));return 0===e?t:t/e}getMarketData(t,e){return e[t]||{symbol:t,prices:[],volume:0,currentPrice:0,highs:[],lows:[],vwap:0,callVolume:0,putVolume:0,unusualActivity:!1,socialSentiment:0,newsSentiment:0,marketCap:0,sectorStrength:0,correlationSPY:0,avgVolume:0}}}}}]);