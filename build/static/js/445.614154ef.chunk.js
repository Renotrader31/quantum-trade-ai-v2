"use strict";(self.webpackChunkquantum_trade_ai_v2=self.webpackChunkquantum_trade_ai_v2||[]).push([[445],{445:(e,t,a)=>{a.d(t,{default:()=>i});const l=new class{constructor(){this.indicators={},this.patterns={}}calculateRSI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14;if(e.length<t+1)return null;const a=[],l=[];for(let s=1;s<e.length;s++){const t=e[s]-e[s-1];a.push(t>0?t:0),l.push(t<0?-t:0)}const n=a.slice(0,t).reduce((e,t)=>e+t,0)/t,i=l.slice(0,t).reduce((e,t)=>e+t,0)/t;if(0===i)return 100;return 100-100/(1+n/i)}calculateStochastic(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:14,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3;if(e.length<l)return null;const i=[];for(let r=l-1;r<e.length;r++){const n=Math.max(...t.slice(r-l+1,r+1)),s=Math.min(...a.slice(r-l+1,r+1)),o=(e[r]-s)/(n-s)*100;i.push(o)}const s=[];for(let r=n-1;r<i.length;r++){const e=i.slice(r-n+1,r+1).reduce((e,t)=>e+t,0)/n;s.push(e)}return{k:i[i.length-1],d:s[s.length-1],signal:i[i.length-1]>80?"OVERBOUGHT":i[i.length-1]<20?"OVERSOLD":"NEUTRAL"}}calculateWilliamsR(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:14;if(e.length<l)return null;const n=Math.max(...t.slice(-l)),i=Math.min(...a.slice(-l));return(n-e[e.length-1])/(n-i)*-100}calculateMACD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:26,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:9;const n=this.calculateEMA(e,t),i=this.calculateEMA(e,a);if(!n||!i)return null;const s=n-i,r=[];for(let c=a-1;c<e.length;c++){const l=this.calculateEMA(e.slice(0,c+1),t),n=this.calculateEMA(e.slice(0,c+1),a);r.push(l-n)}const o=this.calculateEMA(r,l);return{macd:s,signal:o,histogram:s-o,crossover:s>o?"BULLISH":"BEARISH"}}calculateEMA(e,t){if(e.length<t)return null;const a=2/(t+1);let l=e.slice(0,t).reduce((e,t)=>e+t,0)/t;for(let n=t;n<e.length;n++)l=(e[n]-l)*a+l;return l}calculateSMA(e,t){if(e.length<t)return null;return e.slice(-t).reduce((e,t)=>e+t,0)/t}calculateADX(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:14;if(e.length<l+1)return null;const n=[],i=[],s=[];for(let m=1;m<a.length;m++){const l=Math.max(e[m]-t[m],Math.abs(e[m]-a[m-1]),Math.abs(t[m]-a[m-1]));n.push(l);const r=e[m]-e[m-1]>t[m-1]-t[m]?Math.max(e[m]-e[m-1],0):0,o=t[m-1]-t[m]>e[m]-e[m-1]?Math.max(t[m-1]-t[m],0):0;i.push(r),s.push(o)}const r=n.slice(-l).reduce((e,t)=>e+t,0)/l,o=i.slice(-l).reduce((e,t)=>e+t,0)/l/r*100,c=s.slice(-l).reduce((e,t)=>e+t,0)/l/r*100,u=Math.abs(o-c)/(o+c)*100;return{adx:u,plusDI:o,minusDI:c,trend:u>25?o>c?"STRONG_UPTREND":"STRONG_DOWNTREND":"WEAK_TREND"}}calculateBollingerBands(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;if(e.length<t)return null;const l=this.calculateSMA(e,t),n=e.slice(-t).reduce((e,t)=>e+Math.pow(t-l,2),0)/t,i=Math.sqrt(n),s=l+i*a,r=l-i*a,o=e[e.length-1];return{upper:s,middle:l,lower:r,bandwidth:(s-r)/l*100,position:(o-r)/(s-r)*100,signal:o>s?"OVERBOUGHT":o<r?"OVERSOLD":"NEUTRAL"}}calculateATR(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:14;if(e.length<l+1)return null;const n=[];for(let i=1;i<a.length;i++){const l=Math.max(e[i]-t[i],Math.abs(e[i]-a[i-1]),Math.abs(t[i]-a[i-1]));n.push(l)}return n.slice(-l).reduce((e,t)=>e+t,0)/l}calculateVWAP(e,t){if(e.length!==t.length)return null;let a=0,l=0;for(let n=0;n<e.length;n++)a+=e[n]*t[n],l+=t[n];return l>0?a/l:null}calculateOBV(e,t){if(e.length!==t.length||e.length<2)return null;let a=0;const l=[0];for(let n=1;n<e.length;n++)e[n]>e[n-1]?a+=t[n]:e[n]<e[n-1]&&(a-=t[n]),l.push(a);return l[l.length-1]}calculateFibonacci(e,t){const a=e-t;return{level_0:e,level_236:e-.236*a,level_382:e-.382*a,level_500:e-.5*a,level_618:e-.618*a,level_786:e-.786*a,level_100:t}}calculatePivotPoints(e,t,a){const l=(e+t+a)/3;return{pivot:l,r1:2*l-t,r2:l+(e-t),r3:e+2*(l-t),s1:2*l-e,s2:l-(e-t),s3:t-2*(e-l)}}detectCandlestickPatterns(e){if(e.length<3)return[];const t=[],a=e[e.length-1],l=e[e.length-2];e[e.length-3];Math.abs(a.close-a.open)<.1*(a.high-a.low)&&t.push({name:"Doji",type:"REVERSAL",confidence:70,signal:"NEUTRAL"});const n=Math.abs(a.close-a.open),i=a.open<a.close?a.open-a.low:a.close-a.low,s=a.high-Math.max(a.open,a.close);return i>2*n&&s<.5*n&&t.push({name:"Hammer",type:"REVERSAL",confidence:75,signal:"BULLISH"}),l.close>l.open&&a.open<a.close&&a.open<l.close&&a.close>l.open&&t.push({name:"Bullish Engulfing",type:"REVERSAL",confidence:80,signal:"BULLISH"}),t}detectChartPatterns(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(e.length<t)return[];const a=[],l=e.slice(-t),n=Math.max(...l),i=Math.min(...l),s=e[e.length-1];this.calculateSMA(e,20);s>.99*n&&a.push({name:"Upward Breakout",type:"CONTINUATION",confidence:85,signal:"BULLISH"}),s<1.01*i&&a.push({name:"Downward Breakdown",type:"CONTINUATION",confidence:85,signal:"BEARISH"});const r=this.calculateSlope(l.slice(0,10)),o=this.calculateSlope(l.slice(10));return Math.abs(r)<.1&&Math.abs(o)<.1&&a.push({name:"Symmetrical Triangle",type:"CONTINUATION",confidence:70,signal:"NEUTRAL"}),a}calculateSlope(e){const t=e.length,a=t*(t-1)/2,l=e.reduce((e,t)=>e+t,0);return(t*e.reduce((e,t,a)=>e+a*t,0)-a*l)/(t*(t*(t-1)*(2*t-1)/6)-a*a)}performCompleteAnalysis(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=t?t.closes:this.generatePriceHistory(e.price),l=t?t.highs:this.generatePriceHistory(e.high),n=t?t.lows:this.generatePriceHistory(e.low),i=t?t.volumes:this.generateVolumeHistory(e.volume);return{rsi:this.calculateRSI(a),stochastic:this.calculateStochastic(a,l,n),williamsR:this.calculateWilliamsR(a,l,n),macd:this.calculateMACD(a),sma20:this.calculateSMA(a,20),sma50:this.calculateSMA(a,50),ema12:this.calculateEMA(a,12),ema26:this.calculateEMA(a,26),adx:this.calculateADX(l,n,a),bollingerBands:this.calculateBollingerBands(a),atr:this.calculateATR(l,n,a),vwap:this.calculateVWAP(a,i),obv:this.calculateOBV(a,i),fibonacci:this.calculateFibonacci(Math.max(...l),Math.min(...n)),pivotPoints:this.calculatePivotPoints(e.high,e.low,e.price),candlestickPatterns:this.detectCandlestickPatterns(this.generateOHLCData(e,a)),chartPatterns:this.detectChartPatterns(a),overallSignal:this.calculateOverallSignal({rsi:this.calculateRSI(a),macd:this.calculateMACD(a),bollingerBands:this.calculateBollingerBands(a),adx:this.calculateADX(l,n,a)})}}calculateOverallSignal(e){let t=0,a=0,l=0;e.rsi&&(l++,e.rsi<30?t++:e.rsi>70&&a++),e.macd&&(l++,"BULLISH"===e.macd.crossover?t++:"BEARISH"===e.macd.crossover&&a++),e.bollingerBands&&(l++,"OVERSOLD"===e.bollingerBands.signal?t++:"OVERBOUGHT"===e.bollingerBands.signal&&a++),e.adx&&(l++,"STRONG_UPTREND"===e.adx.trend?t++:"STRONG_DOWNTREND"===e.adx.trend&&a++);const n=t/l*100,i=a/l*100;return{signal:n>60?"STRONG_BUY":n>40?"BUY":i>60?"STRONG_SELL":i>40?"SELL":"HOLD",confidence:Math.max(n,i),bullishSignals:t,bearishSignals:a,totalSignals:l}}generatePriceHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;const a=[];let l=.95*e;for(let n=0;n<t;n++)l*=1+.03*(Math.random()-.5),a.push(l);return a}generateVolumeHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;const a=[];let l=e;for(let n=0;n<t;n++)l=Math.max(l*(1+.5*(Math.random()-.5)),1e5),a.push(Math.floor(l));return a}generateOHLCData(e,t){const a=[];for(let l=0;l<Math.min(t.length,10);l++){const e=t[l];a.push({open:e*(1+.02*(Math.random()-.5)),high:e*(1+.03*Math.random()),low:e*(1-.03*Math.random()),close:e})}return a}};const n=new class{constructor(){this.flowPatterns={},this.whaleThresholds={premium:5e4,volume:100,unusualVolume:5},this.sentimentWeights={callPutRatio:.3,volumeProfile:.25,premiumFlow:.25,timeDecay:.2}}analyzeFlowPatterns(e){if(!e||0===e.length)return this.getEmptyAnalysis();const t={whaleActivity:this.detectWhaleActivity(e),sentimentAnalysis:this.analyzeSentiment(e),volumeAnalysis:this.analyzeVolume(e),premiumFlow:this.analyzePremiumFlow(e),timeAnalysis:this.analyzeTimePatterns(e),unusualActivity:this.detectUnusualActivity(e),gamma:this.analyzeGammaExposure(e),strategies:this.identifyStrategies(e)};return t.overallSignal=this.calculateOverallFlowSignal(t),t}detectWhaleActivity(e){const t=e.filter(e=>{const t=e.premium||e.total_premium||0,a=e.volume||0;return t>=this.whaleThresholds.premium||a>=this.whaleThresholds.volume}),a=t.reduce((e,t)=>e+(t.premium||t.total_premium||0),0),l=t.filter(e=>(e.type||e.call_put||"").toLowerCase().includes("call")).reduce((e,t)=>e+(t.premium||t.total_premium||0),0),n=t.filter(e=>(e.type||e.call_put||"").toLowerCase().includes("put")).reduce((e,t)=>e+(t.premium||t.total_premium||0),0);return{totalWhaleFlows:t.length,totalWhalePremium:a,whaleCallPremium:l,whalePutPremium:n,whaleCallPutRatio:n>0?l/n:l>0?999:0,averageWhalePremium:t.length>0?a/t.length:0,largestFlow:t.reduce((e,t)=>Math.max(e,t.premium||t.total_premium||0),0),whaleFlows:t.slice(0,10)}}analyzeSentiment(e){const t=e.filter(e=>(e.type||e.call_put||"").toLowerCase().includes("call")),a=e.filter(e=>(e.type||e.call_put||"").toLowerCase().includes("put")),l=t.reduce((e,t)=>e+(t.volume||0),0),n=a.reduce((e,t)=>e+(t.volume||0),0),i=t.reduce((e,t)=>e+(t.premium||t.total_premium||0),0),s=a.reduce((e,t)=>e+(t.premium||t.total_premium||0),0),r=n>0?l/n:l>0?999:1,o=s>0?i/s:i>0?999:1;let c=50;return r>1.5?c+=15:r>1.2?c+=10:r>1?c+=5:r<.7?c-=15:r<.8?c-=10:r<.9&&(c-=5),o>2?c+=10:o<.5&&(c-=10),{callCount:t.length,putCount:a.length,callVolume:l,putVolume:n,callPremium:i,putPremium:s,callPutRatio:r,premiumRatio:o,sentimentScore:Math.max(0,Math.min(100,c)),sentiment:c>70?"VERY_BULLISH":c>60?"BULLISH":c>40?"NEUTRAL":c>30?"BEARISH":"VERY_BEARISH"}}analyzeVolume(e){const t=e.reduce((e,t)=>e+(t.volume||0),0),a=e.length,l=a>0?t/a:0,n=(e.map(e=>e.strike||e.strike_price||0).filter(e=>e>0),{});e.forEach(e=>{const t=e.strike||e.strike_price||0;t>0&&(n[t]=(n[t]||0)+(e.volume||0))});const i=Object.keys(n).reduce((e,t)=>n[t]>(n[e]||0)?t:e,"0");return{totalVolume:t,totalContracts:a,avgVolumePerContract:l,maxVolumeStrike:parseFloat(i),maxVolumeAmount:n[i]||0,strikeDistribution:Object.keys(n).length,volumeConcentration:t>0?(n[i]||0)/t:0}}analyzePremiumFlow(e){const t=e.reduce((e,t)=>e+(t.premium||t.total_premium||0),0),a={};e.forEach(e=>{const t=e.strike||e.strike_price||0,l=e.premium||e.total_premium||0;t>0&&l>0&&(a[t]=(a[t]||0)+l)});const l=e.reduce((e,t)=>(t.premium||t.total_premium||0)>(e.premium||e.total_premium||0)?t:e,e[0]||{});return{totalPremium:t,avgPremiumPerFlow:e.length>0?t/e.length:0,largestPremiumFlow:l,premiumDistribution:a,highPremiumFlows:e.filter(e=>(e.premium||e.total_premium||0)>this.whaleThresholds.premium).length}}analyzeTimePatterns(e){const t=Date.now(),a=e.filter(e=>{const a=e.timestamp||e.time||t;return t-a<36e5}),l={};e.forEach(e=>{const t=e.expiration||e.exp_date||"unknown";l[t]=(l[t]||0)+1});const n=Object.keys(l).reduce((e,t)=>l[t]>(l[e]||0)?t:e,"unknown");return{totalFlows:e.length,recentFlows:a.length,recentActivity:e.length>0?a.length/e.length:0,expirationDistribution:l,mostPopularExpiration:n,shortTermFlows:Object.keys(l).filter(e=>this.isShortTermExpiration(e)).length}}detectUnusualActivity(e){const t=[],a=e.filter(e=>(e.premium||e.total_premium||0)>2*this.whaleThresholds.premium);a.length>0&&t.push({type:"LARGE_TRADES",count:a.length,description:"".concat(a.length," trades with premium > $").concat(2*this.whaleThresholds.premium),significance:"HIGH"});const l={};e.forEach(e=>{const t=e.strike||e.strike_price||0;l[t]=(l[t]||0)+1});const n=Math.max(...Object.values(l));n>.3*e.length&&t.push({type:"STRIKE_CONCENTRATION",count:n,description:"Heavy concentration at single strike level",significance:"MEDIUM"});const i={};e.forEach(e=>{const t=new Date(e.timestamp||e.time||Date.now()).getHours();i[t]=(i[t]||0)+1});const s=Math.max(...Object.values(i));return s>.5*e.length&&t.push({type:"TIME_CONCENTRATION",count:s,description:"Heavy activity concentrated in single hour",significance:"MEDIUM"}),t}analyzeGammaExposure(e){const t=e.filter(e=>(e.type||e.call_put||"").toLowerCase().includes("call")),a=e.filter(e=>(e.type||e.call_put||"").toLowerCase().includes("put")),l=t.reduce((e,t)=>e+(t.volume||0),0),n=a.reduce((e,t)=>e+(t.volume||0),0),i=l-n;return{callGamma:l,putGamma:n,netGamma:i,gammaImplication:i>1e3?"POSITIVE_GAMMA":i<-1e3?"NEGATIVE_GAMMA":"NEUTRAL_GAMMA",volatilityImpact:Math.abs(i)>2e3?"HIGH":Math.abs(i)>500?"MEDIUM":"LOW"}}identifyStrategies(e){const t=[],a={};return e.forEach(e=>{const t=e.symbol||e.ticker||"UNKNOWN";a[t]||(a[t]=[]),a[t].push(e)}),Object.keys(a).forEach(e=>{const l=a[e];if(l.length<2)return;const n=l.filter(e=>(e.type||e.call_put||"").toLowerCase().includes("call")),i=l.filter(e=>(e.type||e.call_put||"").toLowerCase().includes("put"));if(n.length>0&&i.length>0){const a=n.map(e=>e.strike||e.strike_price||0),l=i.map(e=>e.strike||e.strike_price||0),s=a.filter(e=>l.includes(e));s.length>0&&t.push({type:"LONG_STRADDLE",symbol:e,strikes:s,confidence:80,implication:"VOLATILITY_PLAY"}),0===s.length&&n.length>0&&i.length>0&&t.push({type:"STRANGLE",symbol:e,callStrikes:[...new Set(a)],putStrikes:[...new Set(l)],confidence:70,implication:"VOLATILITY_PLAY"})}l.forEach(a=>{const l=a.volume||0,n=a.premium||a.total_premium||0;(l>500||n>1e5)&&t.push({type:"SWEEP",symbol:e,strike:a.strike||a.strike_price,volume:l,premium:n,confidence:90,implication:"DIRECTIONAL_BET"})})}),t}calculateOverallFlowSignal(e){let t=0,a=0,l=0;const n=this.sentimentWeights.callPutRatio;e.sentimentAnalysis.sentimentScore>60?t+=n*(e.sentimentAnalysis.sentimentScore-50)/50:e.sentimentAnalysis.sentimentScore<40&&(a+=n*(50-e.sentimentAnalysis.sentimentScore)/50),l+=n;const i=this.sentimentWeights.premiumFlow;e.whaleActivity.whaleCallPutRatio>1.5?t+=.8*i:e.whaleActivity.whaleCallPutRatio<.7&&(a+=.8*i),l+=i;const s=this.sentimentWeights.volumeProfile;e.volumeAnalysis.volumeConcentration>.7&&(e.sentimentAnalysis.sentimentScore>50?t+=.6*s:a+=.6*s),l+=s;const r=l>0?(t-a)/l:0,o=100*Math.abs(r);return{signal:r>.3?"BULLISH":r>.1?"SLIGHTLY_BULLISH":r<-.3?"BEARISH":r<-.1?"SLIGHTLY_BEARISH":"NEUTRAL",confidence:Math.min(o,95),score:r,components:{sentimentContribution:(t-a)*n,whaleContribution:e.whaleActivity.whaleCallPutRatio,volumeContribution:e.volumeAnalysis.volumeConcentration}}}isShortTermExpiration(e){if(!e||"unknown"===e)return!1;try{const t=new Date(e),a=new Date;return(t-a)/864e5<=7}catch(t){return!1}}getEmptyAnalysis(){return{whaleActivity:{totalWhaleFlows:0,totalWhalePremium:0,whaleCallPremium:0,whalePutPremium:0,whaleCallPutRatio:0,averageWhalePremium:0,largestFlow:0,whaleFlows:[]},sentimentAnalysis:{callCount:0,putCount:0,callVolume:0,putVolume:0,callPremium:0,putPremium:0,callPutRatio:1,premiumRatio:1,sentimentScore:50,sentiment:"NEUTRAL"},overallSignal:{signal:"NO_DATA",confidence:0,score:0}}}};const i=new class{constructor(){this.strategies={momentum:{weight:.25,performance:.68,parameters:{rsiThreshold:70,macdSignal:!0,volumeMultiplier:1.5}},meanReversion:{weight:.2,performance:.62,parameters:{rsiOversold:30,rsiOverbought:70,bollingerPosition:.1}},breakout:{weight:.2,performance:.75,parameters:{atrMultiplier:2,volumeThreshold:2,adxStrength:25}},flowBased:{weight:.15,performance:.72,parameters:{whaleThreshold:5e4,sentimentScore:60,callPutRatio:1.2}},scalping:{weight:.1,performance:.58,parameters:{quickRsi:14,fastEma:9,slowEma:21}},swing:{weight:.1,performance:.71,parameters:{sma20:!0,sma50:!0,supportResistance:!0}}},this.features=["price","volume","change","rsi","macd","volatility","trend","momentum","support","resistance","bollinger","adx","stochastic","williamsR","atr","vwap","obv","flowSentiment","whaleActivity","gammaExposure"],this.learning={totalTrades:0,successfulTrades:0,strategyPerformance:{},adaptiveWeights:!0,confidenceThreshold:65}}async generateEnhancedRecommendations(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=[];for(const[s,r]of Object.entries(e))try{const e=l.performCompleteAnalysis(r);let i=null;if(t&&t.length>0){const e=t.filter(e=>(e.symbol||e.ticker||"").toUpperCase()===s.toUpperCase());i=n.analyzeFlowPatterns(e)}const o=this.extractEnhancedFeatures(r,e,i),c=this.performEnhancedAnalysis(o,e,i);if(c.confidence>=this.learning.confidenceThreshold){const t={symbol:s,action:c.action,confidence:c.confidence,strategy:c.primaryStrategy,entryPrice:r.price,targetPrice:this.calculateEnhancedTarget(r.price,c),stopLoss:this.calculateEnhancedStopLoss(r.price,c),reasoning:c.reasoning,riskReward:c.riskReward,timeframe:c.timeframe,technicalSignals:this.summarizeTechnicalSignals(e),flowSignals:i?this.summarizeFlowSignals(i):null,probability:this.calculateSuccessProbability(c),positionSize:this.calculatePositionSize(c),timestamp:Date.now(),technicalScore:c.technicalScore,flowScore:i?i.overallSignal.score:0,volatilityScore:o.volatilityScore,momentumScore:o.momentumScore,supportLevel:o.supportLevel,resistanceLevel:o.resistanceLevel};a.push(t)}}catch(i){console.error("Error analyzing ".concat(s,":"),i)}return a.sort((e,t)=>t.confidence-e.confidence).slice(0,10)}extractEnhancedFeatures(e,t,a){const l=this.generatePriceHistory(e.price);return{price:e.price,volume:e.volume/1e6,change:e.changePercent,rsi:t.rsi||50,macd:t.macd?t.macd.macd:0,macdSignal:t.macd?t.macd.signal:0,macdHistogram:t.macd?t.macd.histogram:0,bollingerPosition:t.bollingerBands?t.bollingerBands.position:50,bollingerBandwidth:t.bollingerBands?t.bollingerBands.bandwidth:20,adx:t.adx?t.adx.adx:20,adxTrend:t.adx?t.adx.trend:"WEAK_TREND",sma20:t.sma20||e.price,sma50:t.sma50||e.price,ema12:t.ema12||e.price,ema26:t.ema26||e.price,atr:t.atr||.02*e.price,volatility:this.calculateVolatility(l),vwap:t.vwap||e.price,obv:t.obv||0,supportLevel:t.pivotPoints?t.pivotPoints.s1:e.low,resistanceLevel:t.pivotPoints?t.pivotPoints.r1:e.high,flowSentiment:a?a.sentimentAnalysis.sentimentScore:50,whaleActivity:a?a.whaleActivity.totalWhalePremium:0,callPutRatio:a?a.sentimentAnalysis.callPutRatio:1,gammaExposure:a?a.gamma.netGamma:0,trendStrength:this.calculateTrendStrength(t),momentumScore:this.calculateMomentumScore(t),volatilityScore:this.calculateVolatilityScore(t),volumeScore:this.calculateVolumeScore(e,t)}}performEnhancedAnalysis(e,t,a){const l={},n={};l.momentum=this.analyzeMomentumStrategy(e,t),n.momentum=this.getMomentumReasoning(e,t),l.meanReversion=this.analyzeMeanReversionStrategy(e,t),n.meanReversion=this.getMeanReversionReasoning(e,t),l.breakout=this.analyzeBreakoutStrategy(e,t),n.breakout=this.getBreakoutReasoning(e,t),a&&(l.flowBased=this.analyzeFlowStrategy(e,a),n.flowBased=this.getFlowReasoning(e,a)),l.swing=this.analyzeSwingStrategy(e,t),n.swing=this.getSwingReasoning(e,t);let i=0,s=0;const r=[];Object.keys(l).forEach(e=>{const t=this.strategies[e].weight*this.strategies[e].performance;i+=l[e]*t,s+=t,Math.abs(l[e])>.3&&r.push("".concat(e,": ").concat(n[e]))});const o=s>0?i/s:0,c=o>.15?"BUY":o<-.15?"SELL":"HOLD",u=Math.min(100*Math.abs(o)+50,95),m=Object.keys(l).reduce((e,t)=>Math.abs(l[t])>Math.abs(l[e]||0)?t:e,"momentum");return{action:c,confidence:parseFloat(u.toFixed(1)),primaryStrategy:m,reasoning:r.join(" | "),riskReward:this.calculateRiskReward(o,e),timeframe:this.selectTimeframe(e,m),technicalScore:o,strategyScores:l,overallTechnicalSignal:t.overallSignal}}analyzeMomentumStrategy(e,t){let a=0;return e.rsi>60&&e.rsi<80?a+=.3:e.rsi<40&&e.rsi>20&&(a-=.3),e.macdHistogram>0&&e.macd>e.macdSignal?a+=.25:e.macdHistogram<0&&e.macd<e.macdSignal&&(a-=.25),e.price>e.ema12&&e.ema12>e.ema26?a+=.2:e.price<e.ema12&&e.ema12<e.ema26&&(a-=.2),e.volumeScore>1.2&&(a+=.15),"STRONG_UPTREND"===e.adxTrend?a+=.1:"STRONG_DOWNTREND"===e.adxTrend&&(a-=.1),Math.max(-1,Math.min(1,a))}analyzeMeanReversionStrategy(e,t){let a=0;e.rsi<30?a+=.4:e.rsi>70&&(a-=.4),e.bollingerPosition<20?a+=.3:e.bollingerPosition>80&&(a-=.3);const l=t.williamsR;return l&&l<-80?a+=.2:l&&l>-20&&(a-=.2),t.stochastic&&(t.stochastic.k<20?a+=.1:t.stochastic.k>80&&(a-=.1)),Math.max(-1,Math.min(1,a))}analyzeBreakoutStrategy(e,t){let a=0;return e.price>1.02*e.resistanceLevel?a+=.4:e.price<.98*e.supportLevel&&(a-=.4),e.volumeScore>1.5&&(a+=.3),e.volatilityScore>1.2&&(a+=.2),e.bollingerBandwidth<15&&e.bollingerPosition>60?a+=.1:e.bollingerBandwidth<15&&e.bollingerPosition<40&&(a-=.1),Math.max(-1,Math.min(1,a))}analyzeFlowStrategy(e,t){let a=0;if(t.whaleActivity.totalWhalePremium>1e5&&(t.whaleActivity.whaleCallPutRatio>1.5?a+=.4:t.whaleActivity.whaleCallPutRatio<.7&&(a-=.4)),t.sentimentAnalysis.sentimentScore>70?a+=.3:t.sentimentAnalysis.sentimentScore<30&&(a-=.3),t.unusualActivity.length>0){const e=t.unusualActivity.reduce((e,t)=>"HIGH"===t.significance?Math.max(e,.2):"MEDIUM"===t.significance?Math.max(e,.1):e,0);a+=t.overallSignal.score>0?e:-e}return Math.max(-1,Math.min(1,a))}analyzeSwingStrategy(e,t){let a=0;e.price>e.sma20&&e.sma20>e.sma50?a+=.3:e.price<e.sma20&&e.sma20<e.sma50&&(a-=.3);const l=(e.price-e.supportLevel)/e.price,n=(e.resistanceLevel-e.price)/e.price;return l<.02&&l>0&&(a+=.2),n<.02&&n>0&&(a-=.2),e.price>1.01*e.vwap?a+=.1:e.price<.99*e.vwap&&(a-=.1),Math.max(-1,Math.min(1,a))}calculateTrendStrength(e){let t=0;return e.adx&&e.adx.adx>25&&(t+=.3),e.macd&&"BULLISH"===e.macd.crossover&&(t+=.2),e.sma20&&e.sma50&&e.sma20>e.sma50&&(t+=.2),Math.min(t,1)}calculateMomentumScore(e){let t=0;return e.rsi>50?t+=(e.rsi-50)/50*.4:t-=(50-e.rsi)/50*.4,e.macd&&e.macd.histogram>0?t+=.3:e.macd&&e.macd.histogram<0&&(t-=.3),Math.max(-1,Math.min(1,t))}calculateVolatilityScore(e){if(!e.atr||!e.bollingerBands)return 1;return(Math.min(e.atr/5,2)+e.bollingerBands.bandwidth/20)/2}calculateVolumeScore(e,t){const a=.8*e.volume;return e.volume/a}calculateEnhancedTarget(e,t){t.action;const a=t.volatilityScore||1,l=t.confidence/100,n="BUY"===t.action?1+.05*a*l:1-.05*a*l;return parseFloat((e*n).toFixed(2))}calculateEnhancedStopLoss(e,t){t.action;const a=.03*(1-.3*(t.confidence/100)),l="BUY"===t.action?1-a:1+a;return parseFloat((e*l).toFixed(2))}calculateRiskReward(e,t){const a=2*Math.abs(e)+1,l=.5*(t.volatilityScore||1);return"1:".concat((a+l).toFixed(1))}calculateSuccessProbability(e){let t=e.confidence;return t*=this.strategies[e.primaryStrategy].performance,Math.min(95,Math.max(5,Math.round(t)))}calculatePositionSize(e){const t=e.confidence/100,a=1/(e.volatilityScore||1);return Math.round(1e3*t*a)}selectTimeframe(e,t){return"scalping"===t?"5-15 minutes":"momentum"===t?"1-3 hours":"meanReversion"===t?"2-6 hours":"breakout"===t?"1-5 days":"swing"===t?"3-10 days":"flowBased"===t?"1-2 days":"1-3 days"}getMomentumReasoning(e,t){const a=[];return e.rsi>60&&a.push("Strong RSI momentum"),e.macd>e.macdSignal&&a.push("MACD bullish crossover"),e.adxTrend.includes("STRONG")&&a.push("Strong trend detected"),a.join(", ")||"Momentum analysis"}getMeanReversionReasoning(e,t){const a=[];return e.rsi<30&&a.push("RSI oversold"),e.rsi>70&&a.push("RSI overbought"),e.bollingerPosition<20&&a.push("Below lower Bollinger band"),e.bollingerPosition>80&&a.push("Above upper Bollinger band"),a.join(", ")||"Mean reversion opportunity"}getBreakoutReasoning(e,t){const a=[];return e.price>e.resistanceLevel&&a.push("Resistance breakout"),e.price<e.supportLevel&&a.push("Support breakdown"),e.volumeScore>1.5&&a.push("Volume confirmation"),a.join(", ")||"Breakout pattern"}getFlowReasoning(e,t){const a=[];return t.whaleActivity.totalWhalePremium>1e5&&a.push("Whale activity detected"),t.sentimentAnalysis.sentimentScore>70&&a.push("Bullish flow sentiment"),t.sentimentAnalysis.sentimentScore<30&&a.push("Bearish flow sentiment"),a.join(", ")||"Options flow analysis"}getSwingReasoning(e,t){const a=[];return e.price>e.sma20&&a.push("Above SMA20"),e.price>e.vwap&&a.push("Above VWAP"),a.join(", ")||"Swing trading setup"}summarizeTechnicalSignals(e){return{rsi:e.rsi,macdSignal:e.macd?e.macd.crossover:null,bollingerSignal:e.bollingerBands?e.bollingerBands.signal:null,overallSignal:e.overallSignal?e.overallSignal.signal:null,trendStrength:e.adx?e.adx.trend:null}}summarizeFlowSignals(e){return{sentiment:e.sentimentAnalysis.sentiment,whaleActivity:e.whaleActivity.totalWhaleFlows,callPutRatio:e.sentimentAnalysis.callPutRatio,overallSignal:e.overallSignal.signal,confidence:e.overallSignal.confidence}}generatePriceHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;const a=[];let l=.95*e;for(let n=0;n<t;n++)l*=1+.03*(Math.random()-.5),a.push(l);return a}calculateVolatility(e){if(e.length<2)return.2;const t=[];for(let n=1;n<e.length;n++)t.push((e[n]-e[n-1])/e[n-1]);const a=t.reduce((e,t)=>e+t,0)/t.length,l=t.reduce((e,t)=>e+Math.pow(t-a,2),0)/t.length;return Math.sqrt(252*l)}}}}]);